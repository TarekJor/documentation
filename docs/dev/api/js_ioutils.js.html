<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Source: js/ioutils.js</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <script src="scripts/jquery.min.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/bootstrap.min.css">
    <link type="text/css" rel="stylesheet" href="styles/jaguar.css">
    
    
    <script>
    var config = {"monospaceLinks":false,"cleverLinks":false,"outputSourceFiles":true,"outputSourcePath":true,"applicationName":"TagSpaces API","systemName":"TagSpaces API","navigationBackround":"#008000","footer":"","copyright":"Copyright Â© 2013-2016 The contributors to the TagSpaces project.","navType":"vertical","theme":"united","linenums":true,"collapseSymbols":false,"inverseNav":true,"highlightTutorialCode":true,"default":{"outputSourceFiles":true}};
    </script>
    

    
</head>
<body>
<div id="wrap" class="clearfix">
    
<div class="navigation" style="background-color: #008000"">
    <h3 class="applicationName"><a href="index.html">TagSpaces API</a></h3>

    <div class="search">
        <input id="search" type="text" class="form-control input-sm" placeholder="Search Documentations">
    </div>
    <ul class="list">
    
        <li class="item" data-name="IOAPI">
            <span class="title">
                <a href="IOAPI.html">IOAPI</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IOAPI.ChromeExtension">
            <span class="title">
                <a href="IOAPI.ChromeExtension.html">IOAPI.ChromeExtension</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="IOAPI.ChromeExtension.checkNewVersion"><a href="IOAPI.ChromeExtension.html#.checkNewVersion">checkNewVersion</a></li>
            
                <li data-name="IOAPI.ChromeExtension.copyFilePromise"><a href="IOAPI.ChromeExtension.html#.copyFilePromise">copyFilePromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.createDirectoryPromise"><a href="IOAPI.ChromeExtension.html#.createDirectoryPromise">createDirectoryPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.createDirectoryTree"><a href="IOAPI.ChromeExtension.html#.createDirectoryTree">createDirectoryTree</a></li>
            
                <li data-name="IOAPI.ChromeExtension.deleteDirectoryPromise"><a href="IOAPI.ChromeExtension.html#.deleteDirectoryPromise">deleteDirectoryPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.deleteFilePromise"><a href="IOAPI.ChromeExtension.html#.deleteFilePromise">deleteFilePromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.getFileContentPromise"><a href="IOAPI.ChromeExtension.html#.getFileContentPromise">getFileContentPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.getPropertiesPromise"><a href="IOAPI.ChromeExtension.html#.getPropertiesPromise">getPropertiesPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.listDirectoryPromise"><a href="IOAPI.ChromeExtension.html#.listDirectoryPromise">listDirectoryPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.loadTextFilePromise"><a href="IOAPI.ChromeExtension.html#.loadTextFilePromise">loadTextFilePromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.openDirectory"><a href="IOAPI.ChromeExtension.html#.openDirectory">openDirectory</a></li>
            
                <li data-name="IOAPI.ChromeExtension.openFile"><a href="IOAPI.ChromeExtension.html#.openFile">openFile</a></li>
            
                <li data-name="IOAPI.ChromeExtension.renameDirectoryPromise"><a href="IOAPI.ChromeExtension.html#.renameDirectoryPromise">renameDirectoryPromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.renameFilePromise"><a href="IOAPI.ChromeExtension.html#.renameFilePromise">renameFilePromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.saveFilePromise"><a href="IOAPI.ChromeExtension.html#.saveFilePromise">saveFilePromise</a></li>
            
                <li data-name="IOAPI.ChromeExtension.selectDirectory"><a href="IOAPI.ChromeExtension.html#.selectDirectory">selectDirectory</a></li>
            
                <li data-name="IOAPI.ChromeExtension.selectFile"><a href="IOAPI.ChromeExtension.html#.selectFile">selectFile</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IOAPI.Cordova">
            <span class="title">
                <a href="IOAPI.Cordova.html">IOAPI.Cordova</a>
                
            </span>
            <ul class="members itemMembers">
            
            <span class="subtitle">Members</span>
            
                <li data-name="IOAPI.Cordova.focusWindow
mthod"><a href="IOAPI.Cordova.html#.focusWindowmthod">focusWindow
mthod</a></li>
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="IOAPI.Cordova.checkNewVersion"><a href="IOAPI.Cordova.html#.checkNewVersion">checkNewVersion</a></li>
            
                <li data-name="IOAPI.Cordova.copyFilePromise"><a href="IOAPI.Cordova.html#.copyFilePromise">copyFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.createDirectoryPromise"><a href="IOAPI.Cordova.html#.createDirectoryPromise">createDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Cordova.createDirectoryTree"><a href="IOAPI.Cordova.html#.createDirectoryTree">createDirectoryTree</a></li>
            
                <li data-name="IOAPI.Cordova.deleteDirectoryPromise"><a href="IOAPI.Cordova.html#.deleteDirectoryPromise">deleteDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Cordova.deleteFilePromise"><a href="IOAPI.Cordova.html#.deleteFilePromise">deleteFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.generateDirectoryTree"><a href="IOAPI.Cordova.html#.generateDirectoryTree">generateDirectoryTree</a></li>
            
                <li data-name="IOAPI.Cordova.getFileContentPromise"><a href="IOAPI.Cordova.html#.getFileContentPromise">getFileContentPromise</a></li>
            
                <li data-name="IOAPI.Cordova.getPropertiesPromise"><a href="IOAPI.Cordova.html#.getPropertiesPromise">getPropertiesPromise</a></li>
            
                <li data-name="IOAPI.Cordova.listDirectoryPromise"><a href="IOAPI.Cordova.html#.listDirectoryPromise">listDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Cordova.loadTextFilePromise"><a href="IOAPI.Cordova.html#.loadTextFilePromise">loadTextFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.openDirectory"><a href="IOAPI.Cordova.html#.openDirectory">openDirectory</a></li>
            
                <li data-name="IOAPI.Cordova.openFile"><a href="IOAPI.Cordova.html#.openFile">openFile</a></li>
            
                <li data-name="IOAPI.Cordova.renameDirectoryPromise"><a href="IOAPI.Cordova.html#.renameDirectoryPromise">renameDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Cordova.renameFilePromise"><a href="IOAPI.Cordova.html#.renameFilePromise">renameFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.saveBinaryFilePromise"><a href="IOAPI.Cordova.html#.saveBinaryFilePromise">saveBinaryFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.saveFilePromise"><a href="IOAPI.Cordova.html#.saveFilePromise">saveFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.saveTextFilePromise"><a href="IOAPI.Cordova.html#.saveTextFilePromise">saveTextFilePromise</a></li>
            
                <li data-name="IOAPI.Cordova.selectDirectory"><a href="IOAPI.Cordova.html#.selectDirectory">selectDirectory</a></li>
            
                <li data-name="IOAPI.Cordova.selectFile"><a href="IOAPI.Cordova.html#.selectFile">selectFile</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IOAPI.Electron">
            <span class="title">
                <a href="IOAPI.Electron.html">IOAPI.Electron</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="IOAPI.Electron.checkNewVersion"><a href="IOAPI.Electron.html#.checkNewVersion">checkNewVersion</a></li>
            
                <li data-name="IOAPI.Electron.copyFilePromise"><a href="IOAPI.Electron.html#.copyFilePromise">copyFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.createDirectoryPromise"><a href="IOAPI.Electron.html#.createDirectoryPromise">createDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Electron.createDirectoryTree"><a href="IOAPI.Electron.html#.createDirectoryTree">createDirectoryTree</a></li>
            
                <li data-name="IOAPI.Electron.deleteDirectoryPromise"><a href="IOAPI.Electron.html#.deleteDirectoryPromise">deleteDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Electron.deleteFilePromise"><a href="IOAPI.Electron.html#.deleteFilePromise">deleteFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.getFileContentPromise"><a href="IOAPI.Electron.html#.getFileContentPromise">getFileContentPromise</a></li>
            
                <li data-name="IOAPI.Electron.getPropertiesPromise"><a href="IOAPI.Electron.html#.getPropertiesPromise">getPropertiesPromise</a></li>
            
                <li data-name="IOAPI.Electron.listDirectoryPromise"><a href="IOAPI.Electron.html#.listDirectoryPromise">listDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Electron.listDirectoryPromiseAsync"><a href="IOAPI.Electron.html#.listDirectoryPromiseAsync">listDirectoryPromiseAsync</a></li>
            
                <li data-name="IOAPI.Electron.loadTextFilePromise"><a href="IOAPI.Electron.html#.loadTextFilePromise">loadTextFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.openDirectory"><a href="IOAPI.Electron.html#.openDirectory">openDirectory</a></li>
            
                <li data-name="IOAPI.Electron.openFile"><a href="IOAPI.Electron.html#.openFile">openFile</a></li>
            
                <li data-name="IOAPI.Electron.renameDirectoryPromise"><a href="IOAPI.Electron.html#.renameDirectoryPromise">renameDirectoryPromise</a></li>
            
                <li data-name="IOAPI.Electron.renameFilePromise"><a href="IOAPI.Electron.html#.renameFilePromise">renameFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.saveBinaryFilePromise"><a href="IOAPI.Electron.html#.saveBinaryFilePromise">saveBinaryFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.saveFilePromise"><a href="IOAPI.Electron.html#.saveFilePromise">saveFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.saveTextFilePromise"><a href="IOAPI.Electron.html#.saveTextFilePromise">saveTextFilePromise</a></li>
            
                <li data-name="IOAPI.Electron.selectDirectory"><a href="IOAPI.Electron.html#.selectDirectory">selectDirectory</a></li>
            
                <li data-name="IOAPI.Electron.selectFile"><a href="IOAPI.Electron.html#.selectFile">selectFile</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IOAPI.FirefoxAddon">
            <span class="title">
                <a href="IOAPI.FirefoxAddon.html">IOAPI.FirefoxAddon</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="IOAPI.FirefoxAddon.checkNewVersion"><a href="IOAPI.FirefoxAddon.html#.checkNewVersion">checkNewVersion</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.copyFilePromise"><a href="IOAPI.FirefoxAddon.html#.copyFilePromise">copyFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.createDirectory"><a href="IOAPI.FirefoxAddon.html#.createDirectory">createDirectory</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.createDirectoryPromise"><a href="IOAPI.FirefoxAddon.html#.createDirectoryPromise">createDirectoryPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.createDirectoryTree"><a href="IOAPI.FirefoxAddon.html#.createDirectoryTree">createDirectoryTree</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.deleteDirectoryPromise"><a href="IOAPI.FirefoxAddon.html#.deleteDirectoryPromise">deleteDirectoryPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.deleteFilePromise"><a href="IOAPI.FirefoxAddon.html#.deleteFilePromise">deleteFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.getFileContentPromise"><a href="IOAPI.FirefoxAddon.html#.getFileContentPromise">getFileContentPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.getPropertiesPromise"><a href="IOAPI.FirefoxAddon.html#.getPropertiesPromise">getPropertiesPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.listDirectoryPromise"><a href="IOAPI.FirefoxAddon.html#.listDirectoryPromise">listDirectoryPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.loadTextFilePromise"><a href="IOAPI.FirefoxAddon.html#.loadTextFilePromise">loadTextFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.openDirectory"><a href="IOAPI.FirefoxAddon.html#.openDirectory">openDirectory</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.openFile"><a href="IOAPI.FirefoxAddon.html#.openFile">openFile</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.renameDirectoryPromise"><a href="IOAPI.FirefoxAddon.html#.renameDirectoryPromise">renameDirectoryPromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.renameFilePromise"><a href="IOAPI.FirefoxAddon.html#.renameFilePromise">renameFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.saveBinaryFilePromise"><a href="IOAPI.FirefoxAddon.html#.saveBinaryFilePromise">saveBinaryFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.saveFilePromise"><a href="IOAPI.FirefoxAddon.html#.saveFilePromise">saveFilePromise</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.selectDirectory"><a href="IOAPI.FirefoxAddon.html#.selectDirectory">selectDirectory</a></li>
            
                <li data-name="IOAPI.FirefoxAddon.selectFile"><a href="IOAPI.FirefoxAddon.html#.selectFile">selectFile</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="IOAPI.WebDAV">
            <span class="title">
                <a href="IOAPI.WebDAV.html">IOAPI.WebDAV</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
        <li class="item" data-name="TSCORE">
            <span class="title">
                <a href="TSCORE.html">TSCORE</a>
                
            </span>
            <ul class="members itemMembers">
            
            </ul>
            <ul class="typedefs itemMembers">
            
            </ul>
            <ul class="methods itemMembers">
            
            <span class="subtitle">Methods</span>
            
                <li data-name="TSCORE.initApp"><a href="TSCORE.html#.initApp">initApp</a></li>
            
            </ul>
            <ul class="events itemMembers">
            
            </ul>
        </li>
    
    </ul>
</div>
    <div class="main">
        <h1 class="page-title" data-filename="js_ioutils.js.html">Source: js/ioutils.js</h1>
        


    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>/* Copyright (c) 2012-2015 The Tagspaces Authors. All rights reserved.
 * Use of this source code is governed by a AGPL3 license that
 * can be found in the LICENSE file. */
/* global define  */

/**
 * Description
 * @class IOAPI
 */
define(function(require, exports, module) {
  'use strict';
  console.log('Loading ioutils.js ...');

  var TSCORE = require('tscore');
  var TSPOSTIO = require('tspostioapi');
  var stopDirectoryWalking = false;
  var searchResultsCounter = 0;

  function walkDirectory(path, options, fileCallback, dirCallback) {
    return TSCORE.IO.listDirectoryPromise(path, true).then(function(entries) {
      return Promise.all(entries.map(function(entry) {
        if (!options) {
          options = {};
          options.recursive = false;
        }
        if (entry.isFile) {
          if (fileCallback) {
            return fileCallback(entry);
          } else {
            return entry;
          }
        } else {
          if (dirCallback) {
            return dirCallback(entry);
          }
          if (options.recursive) { //  &amp;&amp; !stopDirectoryWalking &amp;&amp;
            return walkDirectory(entry.path, options, fileCallback, dirCallback);
          } else {
            return entry;
          }
        }
      }));
    }).catch(function(err) {
      console.warn("Error walking directory " + err);
      return null;
    });
  }

  function listSubDirectories(dirPath) {
    console.log("Listing sub directories: " + dirPath);
    TSCORE.showLoadingAnimation();
    TSCORE.IO.listDirectoryPromise(dirPath).then(function(entries) {
      var anotatedDirList = [];
      var firstEntry = 0;
      // skiping the first entry pointing to the parent directory
      if (isChrome) {
        firstEntry = 1;
      }
      for (var i = firstEntry; i &lt; entries.length; i++) {
        if (!entries[i].isFile) {
          anotatedDirList.push({
            "name": entries[i].name,
            "path": entries[i].path
          });
        }
      }
      TSPOSTIO.listSubDirectories(anotatedDirList, dirPath);
    }).catch(function(error) {
      TSPOSTIO.errorOpeningPath(dirPath);
      TSCORE.hideLoadingAnimation();
      console.error("Error listDirectory " + dirPath + " error: " + error);
    });
  }

  function createDirectoryIndex(dirPath) {
    TSCORE.showWaitingDialog($.i18n.t("ns.common:waitDialogDiectoryIndexing"));

    var directoryIndex = [];
    TSCORE.IOUtils.walkDirectory(dirPath, {recursive: true}, function(fileEntry) {
      directoryIndex.push(fileEntry);
    }).then(function(entries) {
      TSCORE.hideWaitingDialog();
      TSCORE.PerspectiveManager.updateFileBrowserData(directoryIndex);
    }).catch(function(err) {
      console.warn("Error creating index: " + err);
      TSCORE.hideWaitingDialog();
    });
  }

  function createDirectoryTree(dirPath) {
    TSCORE.showWaitingDialog($.i18n.t("ns.common:waitDialogDiectoryIndexing"));
    // TODO user promiseAll
    var directoryTree = {};
    /*TSCORE.IOUtils.walkDirectory(dirPath, {recursive: true}, function(fileEntry) {
      directoryIndex.push(fileEntry);
    }).then(function(entries) {
      TSCORE.hideWaitingDialog();
      TSCORE.PerspectiveManager.updateFileBrowserData(directoryIndex);
    }).catch(function(err) {
      console.warn("Error creating index: " + err);
      TSCORE.hideWaitingDialog();
    });*/
  }

  function deleteFiles(filePathList) {
    TSCORE.showLoadingAnimation();
    var fileDeletionPromises = [];
    filePathList.forEach(function(filePath) {
      fileDeletionPromises.push(TSCORE.IO.deleteFilePromise(filePath));
    });

    Promise.all(fileDeletionPromises).then(function(fList) {
      fList.forEach(function(filePath) {
        TSCORE.Meta.deleteMetaData(filePath);
        TSCORE.PerspectiveManager.removeFileUI(filePath);
        if (filePath === TSCORE.FileOpener.getOpenedFilePath()) {
          TSCORE.FileOpener.closeFile(true);
        }
      });
      TSCORE.hideLoadingAnimation();
      TSCORE.showSuccessDialog("Files deleted successfully.");
    }, function(error) {
      TSCORE.hideLoadingAnimation();
      TSCORE.showAlertDialog("Deleting file " + filePath + " failed.");
      console.error("Deleting file " + filePath + " failed " + error);
    });
  }

  exports.stopDirectoryWalking = stopDirectoryWalking;
  exports.walkDirectory = walkDirectory;
  exports.listSubDirectories = listSubDirectories;
  exports.createDirectoryIndex = createDirectoryIndex;
  exports.deleteFiles = deleteFiles;
  //TODO exports.createTree = createTree;
  //TODO exports.copyFiles = copyFiles;
  //TODO exports.moveFiles = moveFiles;
});
</code></pre>
        </article>
    </section>






        

        <footer>
            Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.0</a> on Mon Mar 27 2017 23:48:40 GMT+0200 (CEST)
        </footer>
    </div>
</div>
<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
<script src="scripts/main.js"></script>
</body>
</html>
